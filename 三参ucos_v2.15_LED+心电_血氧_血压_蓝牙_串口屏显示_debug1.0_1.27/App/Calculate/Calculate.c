/*********************************************************************************************************
* 模块名称：LED.c
* 摘    要：LED模块
* 当前版本：1.0.0
* 作    者：Leyutek(COPYRIGHT 2018 - 2021 Leyutek. All rights reserved.)
* 完成日期：2021年07月01日
* 内    容：
* 注    意：                                                                  
**********************************************************************************************************
* 取代版本：
* 作    者：
* 完成日期：
* 修改内容：
* 修改文件：
*********************************************************************************************************/

/*********************************************************************************************************
*                                              包含头文件
*********************************************************************************************************/
#include "Calculate.h"
#include "gd32f30x_conf.h"

/*********************************************************************************************************
*                                              宏定义
*********************************************************************************************************/

/*********************************************************************************************************
*                                              枚举结构体定义
*********************************************************************************************************/

/*********************************************************************************************************
*                                              内部变量
*********************************************************************************************************/

/*********************************************************************************************************
*                                              内部函数声明
*********************************************************************************************************/

/*********************************************************************************************************
*                                              内部函数实现
*********************************************************************************************************/

/*********************************************************************************************************
*                                              API函数实现
*********************************************************************************************************/
/*********************************************************************************************************
* 函数名称：FindMax
* 函数功能：求最大值
* 输入参数：void 
* 输出参数：void
* 返 回 值：void
* 创建日期：2021年07月01日
* 注    意：
*********************************************************************************************************/
short FindMax(short a,short b)
{
  if(a > b)
  {
    return a;
  }
  else
  {
    return b;
  }
}
/*********************************************************************************************************
* 函数名称：FindMin
* 函数功能：求最小值
* 输入参数：void 
* 输出参数：void
* 返 回 值：void
* 创建日期：2021年07月01日
* 注    意：
*********************************************************************************************************/
short FindMin(short a,short b)
{
  if(a > b)
  {
    return b;
  }
  else
  {
    return a;
  }
}
/*********************************************************************************************************
* 函数名称：FindMajority
* 函数功能：求众数
* 输入参数：void 
* 输出参数：void
* 返 回 值：void
* 创建日期：2021年07月01日
* 注    意：
*********************************************************************************************************/
short FindMajority(short *arr,int num)
{
  int i,j;
  short count_arr[40] = {0};
  short max = 0;
  int k;
  for(i = 0;i<num;i++)
  {
    for(j = i;j>=0;j--)
    {
      if(arr[i] == arr[j])
      {
        count_arr[i] = count_arr[j] + 1;
        break;
      }
    }
  }
  for(i = 0;i<num;i++)
  {
    if(max <= count_arr[i])
    {
      max = count_arr[i];
      k = i;
    }
  }
  return arr[k];
}

/*********************************************************************************************************
* 函数名称：FindPeriod_by_Peak
* 函数功能：通过峰值找周期
* 输入参数：arr-数组指针,num-数据量,maxpeakdiff-峰值最大差值,mindistance,周期最小距离
* 输出参数：void
* 返 回 值：数组周期
* 创建日期：2021年07月01日
* 注    意：
*********************************************************************************************************/
short FindPeriod_by_Peak(short *arr,int num,short maxpeakdiff,short mindistance)
{
  short max = 0;
  int i = 0;
  int pre_i = 0;
  int k = 0;
  short Peak_posi_arr[30] = {0};
  for(i = 0;i<num;i++)
  {
    max = FindMax(max,arr[i]);
  }
  for(i = 0;i<num;i++)
  {
    if(arr[i]>max - maxpeakdiff)
    {
      Peak_posi_arr[k] = i - pre_i;
      k++;
      pre_i = i;
      i+=mindistance;
    }
  }
//  for(i = 0;i<k-1;i++)
//  {
//    printf("i = %d arr = %d\r\n",i,Peak_posi_arr[i]);
//  }
  
  return FindMajority(Peak_posi_arr,k-1);
}

